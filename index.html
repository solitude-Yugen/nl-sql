<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NL to SQL Converter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            text-align: center;
        }
        
        .navbar {
            background-color: #FFD580;
            padding: 10px;
            display: flex;
            align-items: center;
        }
        
        .folder-icon {
            margin-right: 15px;
            color: #1976D2;
            font-size: 1.5em;
        }
        
        .search-bar {
            flex-grow: 1;
            padding: 8px;
            border-radius: 15px;
            border: 1px solid #ccc;
            outline: none;
        }
        
        .main-container {
            display: flex;
            flex-grow: 1;
        }
        
        .project-directory {
            background-color: #607D8B;
            color: white;
            width: 20%;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .directory-header {
            background-color: #4CAF50;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .workspace {
            display: flex;
            flex-direction: column;
            width: 80%;
        }
        
        .top-workspace {
            display: flex;
            height: 60%;
        }
        
        .sql-editor {
            background-color: #607D8B;
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .editor-header {
            background-color: #4CAF50;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .editor-content {
            flex-grow: 1;
            background-color: #f5f5f5;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-y: auto;
        }
        
        .results-container {
            display: flex;
            flex-direction: column;
            width: 40%;
            background-color: #607D8B;
        }
        
        .result-table {
            background-color: #607D8B;
            padding: 15px;
            height: 60%;
            display: flex;
            flex-direction: column;
        }
        
        .error-log {
            background-color: #607D8B;
            padding: 15px;
            height: 40%;
            display: flex;
            flex-direction: column;
        }
        
        .log-header {
            background-color: #4CAF50;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .log-content {
            flex-grow: 1;
            background-color: #f5f5f5;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            overflow-y: auto;
            color: red;
        }
        
        .table-content {
            flex-grow: 1;
            background-color: #f5f5f5;
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
        }
        
        .natural-lang-input {
            background-color: #607D8B;
            padding: 15px;
            height: 40%;
            display: flex;
            flex-direction: column;
        }
        
        .input-header {
            background-color: #4CAF50;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        textarea {
            flex-grow: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            resize: none;
            font-family: Arial, sans-serif;
            margin-bottom: 10px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>NATURAL LANGUAGE TO SQL CONVERTER</h2>
    </div>
    
    <div class="navbar">
        <div class="folder-icon">üìÅ</div>
        <input type="text" class="search-bar" placeholder="Search...">
    </div>
    
    <div class="main-container">
        <div class="project-directory">
            <div class="directory-header">PROJECT DIRECTORY</div>
            <div>
                <div id="schema-view">
                    <h3>Database Schema</h3>
                    <div id="schema-content">
                        <p><strong>customers</strong>: customer_id, name, email, city, state</p>
                        <p><strong>products</strong>: product_id, name, price, category</p>
                        <p><strong>orders</strong>: order_id, customer_id, order_date, total</p>
                        <p><strong>order_items</strong>: item_id, order_id, product_id, quantity, price</p>
                    </div>
                </div>
                <button onclick="editSchema()">Edit Schema</button>
            </div>
        </div>
        
        <div class="workspace">
            <div class="top-workspace">
                <div class="sql-editor">
                    <div class="editor-header">SQL EDITOR</div>
                    <div class="editor-content" id="sql-output" contenteditable="true"></div>
                    <div style="margin-top: 10px; display: flex; justify-content: space-between;">
                        <button onclick="copyToClipboard()">Copy SQL</button>
                        <button onclick="executeSQL()">Execute SQL</button>
                    </div>
                </div>
                
                <div class="results-container">
                    <div class="result-table">
                        <div class="editor-header">RESULT/TABLE</div>
                        <div class="table-content" id="result-content">
                            <em>No results to display</em>
                        </div>
                    </div>
                    
                    <div class="error-log">
                        <div class="log-header">ERROR LOG</div>
                        <div class="log-content" id="error-content"></div>
                    </div>
                </div>
            </div>
            
            <div class="natural-lang-input">
                <div class="input-header">NATURAL LANG INPUT</div>
                <textarea id="nl-input" placeholder="Enter your query in natural language (e.g., 'Show me all customers from New York')"></textarea>
                <button onclick="convertToSQL()">Convert to SQL</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sql.js@1.8.0/dist/sql-wasm.js"></script>
    <script>
        // Global variables
        let db;
        let SQL;
        let schema = `
CREATE TABLE customers (
    customer_id INT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100),
    city VARCHAR(50),
    state VARCHAR(2)
);

CREATE TABLE products (
    product_id INT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10, 2),
    category VARCHAR(50)
);

CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    total DECIMAL(10, 2),
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
);

CREATE TABLE order_items (
    item_id INT PRIMARY KEY,
    order_id INT,
    product_id INT,
    quantity INT,
    price DECIMAL(10, 2),
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);`;

        // Initialize SQL.js
        initSqlJs({
            locateFile: file => `https://cdn.jsdelivr.net/npm/sql.js@1.8.0/dist/sql-wasm.wasm`
        }).then(function(sql) {
            SQL = sql;
            db = new SQL.Database();
            console.log("SQL.js initialized");
            
            // Initialize the database with schema
            try {
                db.run(schema);
                console.log("Schema initialized");
                
                // Add some sample data
                db.run(`
                    INSERT INTO customers VALUES (1, 'John Doe', 'john@example.com', 'New York', 'NY');
                    INSERT INTO customers VALUES (2, 'Jane Smith', 'jane@example.com', 'Los Angeles', 'CA');
                    INSERT INTO customers VALUES (3, 'Bob Johnson', 'bob@example.com', 'Chicago', 'IL');
                    
                    INSERT INTO products VALUES (1, 'Laptop', 999.99, 'Electronics');
                    INSERT INTO products VALUES (2, 'Smartphone', 499.99, 'Electronics');
                    INSERT INTO products VALUES (3, 'Headphones', 99.99, 'Accessories');
                    
                    INSERT INTO orders VALUES (1, 1, '2023-01-15', 999.99);
                    INSERT INTO orders VALUES (2, 2, '2023-01-20', 599.98);
                    INSERT INTO orders VALUES (3, 1, '2023-02-10', 99.99);
                    
                    INSERT INTO order_items VALUES (1, 1, 1, 1, 999.99);
                    INSERT INTO order_items VALUES (2, 2, 2, 1, 499.99);
                    INSERT INTO order_items VALUES (3, 2, 3, 1, 99.99);
                    INSERT INTO order_items VALUES (4, 3, 3, 1, 99.99);
                `);
                console.log("Sample data added");
            } catch (err) {
                document.getElementById('error-content').innerText = `Error initializing schema: ${err.message}`;
            }
        }).catch(err => {
            document.getElementById('error-content').innerText = `Failed to load SQL.js: ${err.message}`;
        });

        // Function to edit schema
        function editSchema() {
            const currentSchema = schema;
            const newSchema = prompt("Edit database schema:", currentSchema);
            
            if (newSchema && newSchema !== currentSchema) {
                try {
                    // Reinitialize the database with the new schema
                    db = new SQL.Database();
                    db.run(newSchema);
                    schema = newSchema;
                    
                    // Update schema view
                    updateSchemaView();
                    
                    console.log("Schema updated");
                } catch (err) {
                    document.getElementById('error-content').innerText = `Error updating schema: ${err.message}`;
                }
            }
        }

        // Function to update schema view
        function updateSchemaView() {
            // Simple parser to extract table and column info from schema
            const tables = [];
            const tableRegex = /CREATE\s+TABLE\s+(\w+)\s*\(([\s\S]*?)\)/gi;
            let match;
            
            while ((match = tableRegex.exec(schema)) !== null) {
                const tableName = match[1];
                const columnsText = match[2];
                
                const columns = columnsText
                    .split(',')
                    .map(col => col.trim().split(/\s+/)[0])
                    .filter(col => col && !col.startsWith('FOREIGN') && !col.startsWith('PRIMARY'));
                
                tables.push({
                    name: tableName,
                    columns: columns
                });
            }
            
            // Update the view
            const schemaContent = document.getElementById('schema-content');
            schemaContent.innerHTML = '';
            
            tables.forEach(table => {
                const p = document.createElement('p');
                p.innerHTML = `<strong>${table.name}</strong>: ${table.columns.join(', ')}`;
                schemaContent.appendChild(p);
            });
        }

        // Function to execute SQL
        function executeSQL() {
            const sqlQuery = document.getElementById('sql-output').innerText;
            if (!sqlQuery.trim()) {
                document.getElementById('error-content').innerText = "No SQL query to execute";
                return;
            }
            
            try {
                // Clear previous errors
                document.getElementById('error-content').innerText = "";
                
                // Execute the query
                const result = db.exec(sqlQuery);
                displayResults(result);
            } catch (error) {
                document.getElementById('error-content').innerText = error.message;
            }
        }

        // Function to display results
        function displayResults(results) {
            const resultContainer = document.getElementById('result-content');
            
            if (!results || results.length === 0) {
                resultContainer.innerHTML = "<em>Query executed successfully, but returned no results.</em>";
                return;
            }
            
            let tableHtml = "";
            
            results.forEach(result => {
                tableHtml += "<table>";
                
                // Table headers
                tableHtml += "<tr>";
                result.columns.forEach(column => {
                    tableHtml += `<th>${column}</th>`;
                });
                tableHtml += "</tr>";
                
                // Table rows
                result.values.forEach(row => {
                    tableHtml += "<tr>";
                    row.forEach(cell => {
                        tableHtml += `<td>${cell !== null ? cell : "NULL"}</td>`;
                    });
                    tableHtml += "</tr>";
                });
                
                tableHtml += "</table><br>";
            });
            
            resultContainer.innerHTML = tableHtml;
        }

        // Function to convert natural language to SQL
        function convertToSQL() {
            const nlQuery = document.getElementById('nl-input').value.trim();
            if (!nlQuery) {
                document.getElementById('error-content').innerText = "Please enter a natural language query";
                return;
            }
            
            document.getElementById('error-content').innerText = "";
// Function to convert natural language to SQL (continued)
    try {
        // This is a rule-based NL to SQL converter
        // It uses pattern matching to generate SQL queries without requiring external APIs
        
        // Convert query to lowercase for easier matching
        const query = nlQuery.toLowerCase();
        let sqlQuery = "";
        
        // Pattern matching for common query types
        if (query.includes("show") || query.includes("list") || query.includes("get") || 
            query.includes("display") || query.includes("select") || query.includes("find")) {
            
            // Determine which table to query
            let tableName = "";
            if (query.includes("customer")) tableName = "customers";
            else if (query.includes("product")) tableName = "products";
            else if (query.includes("order")) {
                if (query.includes("item") || query.includes("line")) 
                    tableName = "order_items";
                else 
                    tableName = "orders";
            }
            
            // If no table is explicitly mentioned but there's a specific attribute
            if (!tableName) {
                if (query.includes("name") || query.includes("email") || query.includes("city") || query.includes("state"))
                    tableName = "customers";
                else if (query.includes("price") || query.includes("category"))
                    tableName = "products";
                else if (query.includes("date") || query.includes("total"))
                    tableName = "orders";
                else if (query.includes("quantity"))
                    tableName = "order_items";
                else
                    tableName = "customers"; // Default to customers
            }
            
            // Determine if we need specific columns or all columns
            let columns = "*";
            if (query.includes("name")) {
                if (tableName === "customers") columns = "name";
                else if (tableName === "products") columns = "name";
            } else if (query.includes("email")) columns = "email";
            else if (query.includes("city")) columns = "city";
            else if (query.includes("state")) columns = "state";
            else if (query.includes("price")) columns = "price";
            else if (query.includes("category")) columns = "category";
            else if (query.includes("date")) columns = "order_date";
            else if (query.includes("total")) columns = "total";
            else if (query.includes("quantity")) columns = "quantity";
            
            // Build WHERE clause
            let whereClause = "";
            
            // Match city conditions
            const cityPattern = /(from|in) ([a-z ]+)/i;
            const cityMatch = query.match(cityPattern);
            if (cityMatch && tableName === "customers") {
                const city = cityMatch[2].trim();
                whereClause = `WHERE city = '${city}'`;
            }
            
            // Match state conditions
            const statePattern = /(from|in) ([a-z]{2})/i;
            const stateMatch = query.match(statePattern);
            if (stateMatch && tableName === "customers") {
                const state = stateMatch[2].toUpperCase();
                whereClause = `WHERE state = '${state}'`;
            }
            
            // Match category conditions
            const categoryPattern = /(in|from) (category|categories) ([a-z ]+)/i;
            const categoryMatch = query.match(categoryPattern);
            if (categoryMatch && tableName === "products") {
                const category = categoryMatch[3].trim();
                whereClause = `WHERE category = '${category}'`;
            }
            
            // Detect price conditions
            if (query.includes("less than") || query.includes("cheaper than") || query.includes("under")) {
                const pricePattern = /(less than|cheaper than|under) (\d+(\.\d+)?)/i;
                const priceMatch = query.match(pricePattern);
                if (priceMatch && (tableName === "products" || tableName === "order_items")) {
                    const price = priceMatch[2];
                    whereClause = `WHERE price < ${price}`;
                }
            } else if (query.includes("more than") || query.includes("greater than") || query.includes("over")) {
                const pricePattern = /(more than|greater than|over) (\d+(\.\d+)?)/i;
                const priceMatch = query.match(pricePattern);
                if (priceMatch && (tableName === "products" || tableName === "order_items")) {
                    const price = priceMatch[2];
                    whereClause = `WHERE price > ${price}`;
                }
            }
            
            // Detect date conditions
            if (query.includes("before")) {
                const datePattern = /before ['"]?(\d{4}-\d{2}-\d{2})['"]?/i;
                const dateMatch = query.match(datePattern);
                if (dateMatch && tableName === "orders") {
                    const date = dateMatch[1];
                    whereClause = `WHERE order_date < '${date}'`;
                }
            } else if (query.includes("after")) {
                const datePattern = /after ['"]?(\d{4}-\d{2}-\d{2})['"]?/i;
                const dateMatch = query.match(datePattern);
                if (dateMatch && tableName === "orders") {
                    const date = dateMatch[1];
                    whereClause = `WHERE order_date > '${date}'`;
                }
            }
            
            // Detect sorting
            let orderBy = "";
            if (query.includes("sort by") || query.includes("order by")) {
                let sortField = "";
                let sortOrder = "ASC";
                
                if (query.includes("price")) sortField = "price";
                else if (query.includes("date")) sortField = "order_date";
                else if (query.includes("name")) sortField = "name";
                
                if (query.includes("descending") || query.includes("high to low") || 
                    query.includes("newest") || query.includes("latest")) {
                    sortOrder = "DESC";
                }
                
                if (sortField) {
                    orderBy = `ORDER BY ${sortField} ${sortOrder}`;
                }
            }
            
            // Detect limits
            let limitClause = "";
            const limitPattern = /(top|first) (\d+)/i;
            const limitMatch = query.match(limitPattern);
            if (limitMatch) {
                const limit = limitMatch[2];
                limitClause = `LIMIT ${limit}`;
            }
            
            // Build the full query
            sqlQuery = `SELECT ${columns} FROM ${tableName} ${whereClause} ${orderBy} ${limitClause}`;
        } 
        // INSERT queries
        else if (query.includes("add") || query.includes("insert") || query.includes("create")) {
            let tableName = "";
            if (query.includes("customer")) tableName = "customers";
            else if (query.includes("product")) tableName = "products";
            else if (query.includes("order")) {
                if (query.includes("item")) tableName = "order_items";
                else tableName = "orders";
            }
            
            // This is a simplified version - in a real app, you'd parse out the values
            if (tableName) {
                sqlQuery = `INSERT INTO ${tableName} VALUES (/* Values would go here */);
/* Example:
INSERT INTO ${tableName} (column1, column2) VALUES (value1, value2); */`;
            }
        } 
        // UPDATE queries
        else if (query.includes("update") || query.includes("change") || query.includes("modify")) {
            let tableName = "";
            if (query.includes("customer")) tableName = "customers";
            else if (query.includes("product")) tableName = "products";
            else if (query.includes("order")) {
                if (query.includes("item")) tableName = "order_items";
                else tableName = "orders";
            }
            
            if (tableName) {
                sqlQuery = `UPDATE ${tableName} SET /* column = value */ WHERE /* condition */;
/* Example:
UPDATE ${tableName} SET price = 199.99 WHERE product_id = 1; */`;
            }
        }
        // DELETE queries
        else if (query.includes("delete") || query.includes("remove")) {
            let tableName = "";
            if (query.includes("customer")) tableName = "customers";
            else if (query.includes("product")) tableName = "products";
            else if (query.includes("order")) {
                if (query.includes("item")) tableName = "order_items";
                else tableName = "orders";
            }
            
            if (tableName) {
                sqlQuery = `DELETE FROM ${tableName} WHERE /* condition */;
/* Example: 
DELETE FROM ${tableName} WHERE product_id = 3; */`;
            }
        }
        // CREATE TABLE (DDL)
        else if (query.includes("create table") || query.includes("new table")) {
            // Extract table name - simple approach
            const tableNamePattern = /table (\w+)/i;
            const tableMatch = query.match(tableNamePattern);
            let tableName = tableMatch ? tableMatch[1] : "new_table";
            
            sqlQuery = `CREATE TABLE ${tableName} (
    id INT PRIMARY KEY,
    /* Define other columns here */
    name VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);`;
        }
        // ALTER TABLE (DDL)
        else if (query.includes("alter table") || query.includes("modify table") || query.includes("change table")) {
            // Extract table name - simple approach
            const tableNamePattern = /table (\w+)/i;
            const tableMatch = query.match(tableNamePattern);
            let tableName = tableMatch ? tableMatch[1] : "table_name";
            
            if (query.includes("add column") || query.includes("new column")) {
                sqlQuery = `ALTER TABLE ${tableName} ADD COLUMN new_column VARCHAR(100);`;
            } else if (query.includes("drop column") || query.includes("remove column") || query.includes("delete column")) {
                sqlQuery = `ALTER TABLE ${tableName} DROP COLUMN column_name;`;
            } else {
                sqlQuery = `ALTER TABLE ${tableName} /* Specify alteration */;
/* Examples:
ALTER TABLE ${tableName} ADD COLUMN new_column VARCHAR(100);
ALTER TABLE ${tableName} DROP COLUMN column_name;
ALTER TABLE ${tableName} MODIFY COLUMN column_name NEW_TYPE; */`;
            }
        }
        // DROP TABLE (DDL)
        else if (query.includes("drop table") || query.includes("delete table") || query.includes("remove table")) {
            // Extract table name - simple approach
            const tableNamePattern = /table (\w+)/i;
            const tableMatch = query.match(tableNamePattern);
            let tableName = tableMatch ? tableMatch[1] : "table_name";
            
            sqlQuery = `DROP TABLE ${tableName};`;
        }
        // JOIN queries
        else if (query.includes("join") || query.includes("combine") || 
                (query.includes("order") && query.includes("customer")) ||
                (query.includes("product") && query.includes("order"))) {
                
            if (query.includes("customer") && query.includes("order")) {
                sqlQuery = `SELECT c.name, o.order_id, o.order_date, o.total
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id;`;
            } else if (query.includes("product") && query.includes("order")) {
                sqlQuery = `SELECT p.name, oi.quantity, oi.price, o.order_date
FROM products p
JOIN order_items oi ON p.product_id = oi.product_id
JOIN orders o ON oi.order_id = o.order_id;`;
            }
        }
        // DEFAULT query if no pattern matched
        if (!sqlQuery) {
            sqlQuery = `SELECT * FROM customers;
-- Your query "${nlQuery}" didn't match our patterns.
-- Try asking for something like:
-- "Show all customers from New York"
-- "List products in Electronics category"
-- "Find orders placed after 2023-01-01"`;
        }
        
        // Clean up the query by removing extra spaces
        sqlQuery = sqlQuery.replace(/\s+/g, ' ').trim().replace(/ ;/g, ';');
        
        // Format multiline queries properly
        if (sqlQuery.includes(';')) {
            sqlQuery = sqlQuery.split(';').map(q => q.trim()).filter(q => q).join(';\n\n');
            if (!sqlQuery.endsWith(';')) sqlQuery += ';';
        }
        
        // Display in editor
        document.getElementById('sql-output').innerText = sqlQuery;
    } catch (error) {
        document.getElementById('error-content').innerText = `Error converting to SQL: ${error.message}`;
    }
}

// Function to copy SQL to clipboard
function copyToClipboard() {
    const sqlText = document.getElementById('sql-output').innerText;
    if (!sqlText.trim()) {
        return;
    }
    
    navigator.clipboard.writeText(sqlText)
        .then(() => {
            // Flash success message
            const originalText = document.getElementById('sql-output').innerText;
            document.getElementById('sql-output').innerText = "Copied to clipboard!";
            setTimeout(() => {
                document.getElementById('sql-output').innerText = originalText;
            }, 1000);
        })
        .catch(err => {
            document.getElementById('error-content').innerText = `Failed to copy: ${err.message}`;
        });
}
</script>
</body>
</html>
